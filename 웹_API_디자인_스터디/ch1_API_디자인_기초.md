# 1. API 디자인이란 무엇인가?

웹 애플리케이션 프로그래밍 인터페이스(API, Application Programming Interface)는 우리가 살고 있는 연결된 세상의 중추라 할 수 있다.

이 책에서 말하는 API는 원격 API, 엄밀히 말하면 `웹 API`를 의미한다. 즉, 소프트웨어를 위한 웹 인터페이스를 말한다. 인터페이스란 두 개의 시스템, 대상, 조직 또는 그 밖의 대상들이 만나고 상호작용하는 지점을 의미한다.

API는 함수를 통해 데이터를 입력하고, 또는 출력하는 피드백을 제공한다. API는 소프트웨어가 제공하는 인터페이스다. 인터페이스란 API를 사용할 때 소프트웨어 내부에서 실제로 벌어지는 구체적인 구현이 아닌 추상화된 개념을 의미한다.

책에서 소프트웨어를 레고처럼 만든다고 비유하고 있다. 거대한 소프트웨어 시스템을 블록처럼 분해해 쉽게 조립하고 교체할 수 있게 만들 수 있다는 말이다.
**소프트웨어 블록은 인터넷에만 연결되어있다면 API로 접근이 가능해 어디서든 실행할 수 있다. 이러한 점이 API로 하여금 성능과 확장성을 관리하는데 유리하게 해준다.**

세상에는 두 종류의 API블록이 있다. 하나는 `퍼블릭 API`이며, 다른 하나는 `프라이빗 API`이다. 퍼블릭 API는 외부에 서비스 또는 제품 형태로 제공된다.
프라이빗 API와 퍼블릭 API 사이에는 다양한 종류의 상호작용이 발생한다.

## API 디자인이 중요한 이유?

API는 일반적으로 소프트웨어를 위한 것이지만, 소프트웨어를 만들고 사용하는 주체는 바로 개발자이며 사람이다. 사람들이 기대하는 프로그래밍 인터페이스는 유용하고 단순해야 한다. 적절하게 디자인된 다른 인터페이스처럼 말이다.

퍼플릭이건 프라이빗이건, API의 목적이 무엇이든, 회사의 조직 조가 어떻든 머지않아 API를 노출하는 소프트웨어의 개발 과정에 전혀 관련이 없는 개발자들이 API를 사용하게 된다. 따라서 새로운 개발자가 이해할 수 있도록 API를 사용하는 코드를 작성해야 한다.

API는 개발자들이 그들의 소프트웨어에서 쓸 수 있도록 제공하는 인터페이스라는 점을 되새겨야 한다. 형편없이 디자인된 API는 이해하기도 사용하기도 끔찍하게 어려울뿐더러 끔찍한 결과를 불러올 가능성이 높다.

**API의 디자인 결함은 이 API를 사용하는 소프트웨어가 들이는 시간과 노력과 비용을 증가시키며 API의 보안 측면 취약성을 야기시킬 수도 있다.**

API 디자인을 학습하기 위해서는 기술뿐 아니라 API 디자인의 모든 측면을 이해해야 한다. API 디자인을 할 때는 반드시 커스터머의 측면과 프로바이더 측면으로 인터페이스의 두 가지 면을 고려해야 한다.

**API를 디자인한다는 것은 혼자 이해하기 쉽고 사용하기 쉬운 인터페이스를 만드는 것을 의미하지 않는다.** 반드시 매우 안전한 인터페이스를 설계해야 한다. 민감한 데이터나 동작을 컨슈머에게 과도하게 노출해서는 안되며, **반드시 모든 컨텍스트를 염두에 둬야 한다.**
어떤 제약이 있는지, 어떻게 API가 누구에 의해 쓰일 것인지, 어떻게 API가 만들어질 것이며 어떤 식으로 성장해 나갈 것인지 등 모든 라이프사이클에 관여해야 한다.

# 2. 사용자를 위한 API 디자인하기

맹목적으로 데이터와 기능을 노출한다고 API가 되는게 아니다. API는 `사용자의 목표를 달성하기 위해서` 존재한다.

`목표 식별`이야말로 API디자인 과정에서 가장 중대한 단계라고 할 수 있다. 목표, 다시 말해 사용자가 API를 사용해 이룰 수 있는 바는 사용자들에게 일단 합리적이어야 할 뿐 아니라 오해의 여지도 없어야 한다.

우리는 `컨슈머의 관점`에 중점을 두어야 한다. **즉, API 사용자의 관점과 API를 소비하는 컨슈머 소프트웨어의 입장으로 생각해야 한다.** 이러한 관점이 API 디자인의 초석이자 디자인 중에 반드시 따라야 하는 원칙이다.

올바른 입장, 올바른 관점을 선택하는 것이 인터페이스와 API를 디자인하는데 있어서 가장 중요하다.

동작 원리에만 지나치게 몰입하면 이해하기도, 사용하기에도 어려워진다. 사용자가 할 수 있는 일에 집중해야한다. 우리는 이해하기 쉽고, 사용하기 쉬우며, 사용자가 할 수 있는 일을 표현하는 인터페이스를 만들어야 한다.

## 소프트웨어 인터페이스 디자인 방법

사용하기 쉽고, 이해하기도 쉬운 API를 만드는 건 우리가 좋은 관점에 집중하고 있어야 가능하다. 사용자가 할 수 있는 일에 집중해야 한다.

공급자의 관점에서 API를 설계하면 과도한 내부 작업이 노출되고, 이해하기도, 사용하기도 어려운 API가 탄생한다. **API는 반드시 컨슈머의 관점에서 디자인되어야 한다.**
컨슈머 관점에서 디자인된 API는 내부의 동작을 숨기고, 자연스럽게 사용성이 좋아진다. 어떻게 컨슈머의 목표를 정확하고 철저하게 알아낼 수 있을까?

## API 목표 식별 과정

- 누가 API를 사용하는가?
- 무엇을 할 수 있는가?
- 어떻게 하는가?
- 하기 위해서 무엇이 필요한가?
- 끝나면 무엇을 반환하는가?

이 정보들은 만들 API의 기초가 되며, 동시에 정확한 API 인터페이스를 디자인하기 위해 꼭 알아야 한다.

### 무엇을 어떻게 하는가

- 사용자는 무엇을 할 수 있는가?
- 사용자가 어떻게 하는가?

### 어떤 걸 입력하고 어떤 게 출력되는가

- 사용자는 무엇을 할 수 있는가?
- 그들은 그걸 어떻게 하는가?
- 입력에 대한 새로운 질문: 그것을 하기 위해 무엇이 필요한가?
- 출력에 대한 새로운 질문: 그들은 무엇을 반환하는가?

### 누락된 목표가 있는가

- 사용자는 무엇을 할 수 있는가?
- 그걸 어떻게 하는가?
- 그것을 하기 위해 무엇이 필요한가?
- 사용자는 무엇을 반환 받는가?
- 누락된 목표를 식별하기 위한 새로운 질문: 입력은 어디를 통해서 들어오는가?
- 누락된 목표를 식별하기 위한 새로운 질문: 출력은 어디에서 어떻게 쓰이는가?

### 모든 사용자를 찾아냈는가

- 모든 사용자를 식별하고 다른 무엇들을 누락시키지 않기 위한 새로운 질문: 누가 사용자인가?
- 사용자는 무엇을 할 수 있는가?
- 그걸 어떻게 하는가?
- 그것을 하기 위해 무엇이 필요한가?
- 사용자는 무엇을 반환 받는가?
- 입력은 어디를 통해서 들어오는가?
- 출력은 어디에서 어떻게 쓰이는가?

## API 디자인에서 피해야 할 프로바이더 관점

모든 디자인 단계에서 프로바이더의 관점은 나타난다. 불행하게도 이러한 프로바이더 관점은 항상 분명하게 식별할 수 없다.

### 데이터가 미치는 영향

API는 근본적으로 컨슈머와 프로바이더라는 두 개의 다른 소프트웨어 간의 데이터를 교환하는 방법을 의미한다. 그러므로 일반적으로 API 디자인은 데이터의 구조에 유사하게 표현되는 경향이 있다. 데이터의 체계라던가, 데이터와 관련된 요소들의 이름 등이 API 디자인에 영향을 미친다.

데이터의 체계와 이름을 그대로 API 목표와 데이터에 매핑하는 것은 이해하기도 어렵고 사용하기도 어렵게 만든다. 데이터 모델의 노출은 프로바이더 관점이 들어갔다는 매우 명백한 징후이다.

### 코드와 비즈니스 로직이 주는 영향

비즈니스 로직을 노출하면 API가 컨슈머를 괴롭힐 뿐만 아니라 프로바이더에게도 고통을 준다.

내부의 비즈니스 로직을 노출하는 것은 API의 컨슈머가 이해하기도 어렵고 사용하기도 어렵게 만들뿐더러 프로바이더에게도 위험하다.

### 소프트웨어 아키텍처에서 받는 영향

컨슈머는 여러분의 소프트웨어 아키텍처적 선택에 전혀 관심이 없다. 소프트웨어 아키텍쳐는 항상 숨겨져야 한다.

### 인적 조직으로 인한 영향

숨겨야 하는 인적 조직을 API 디자인에 매핑시키는 것은 API를 이해하기 어렵고 사용하기 어렵게 만들뿐더러 전혀 관련없는 일이다. API 목표를 식별하는 동안에는 항상 여러분의 무엇드로가 어떻게들이 정말 컨슈머의 관심사일지 확인할 필요가 있다.

**결국 모든 프로바이더 관점의 다양한 측면들로 인한 불필요한 외부 노출들은 컨슈머의 API에 대한 관심사와는 전혀 관계가 없다.**

# 3. 프로그래밍 인터페이스 디자인하기

`REST`란 Representational State Transfer를 의미한다.
REST API는 REST 아키텍처 스타일을 기반으로 한다.

## REST API

REST API는 API 사용자가 목표를 달성하게 하도록 요청한 경로로 식별한 리소스를 HTTP 표준 메서드를 통해 조작할 수 있게 해주어야 한다.

**REST API는 HTTP 프로토콜을 이용해서 목표를 표현한다. API의 목표는 리소스와 액션의 쌍으로 변형된다. 리소스는 경로로 식별되고, 액션은 HTTP 메서드를 의미한다.**

## API 목표를 REST API로 변형하는 과정

리소스를 프로그래밍적 표현으로 옮기기 전에 기능적 요구사항을 분석한다.

우선 리소스(기능적 개념)와 리소스 사이의 관계(어떤 식으로 구조화되었는지)를 식별해내야 한다. 그리고 리소스별로 가능한 액션과 파라미터, 무엇이 리턴되는지 식별해야 한다.

여기까지 끝나면 리소스 경로와 HTTP 메서드를 통해 액션을 표현함으로써 HTTP 프로그래밍 인터페이스를 디자인할 수 있게 된다.

책에서는 API 목표 캔버스를 이용해서 리소스와 리소스 사이의 관계를 식별한다.
API 목표 캔버스란 누가 사용자인가, 그들이 무엇을 할 수 있는가, 어떻게 해야 하는가, 무엇이 필요한가, 그리고 무엇을 리턴하는가를 묘사해준다. 이를 이용하여 API 목표를 REST API로 바꿔볼 수 있다.

REST 리소스의 경로는 반드시 유일해야 한다. 리소스 경로는 어떤 방식이든 선택할 수 있지만, 리소스의 경로는 반드시 사용자 친화적이어야 한다.

## API 데이터 디자인하기

컨슈머가 반드시 데이터를 이해하도록 만드는 동시에 내부 동작 원리를 노출하지 않는 디자인을 만들어야 한다.

먼저 데이터 구조에 포함되는 속성들을 나열하고 이름을 부여한다. 그리고 개별 속성을 컨슈머가 이해할 수 있는지, 컨슈머가 관심을 두는지, 실제로 컨슈머에게 쓸모있는 정보인지 판단해야 한다.

각 속성의 타입도 분명히 해야 한다. 이름과 타입은 프로그래밍 인터페이스를 디자인할 때 속성으로 수집할 수 있는 가장 분명한 정보이며, API는 하나만 만들어도 여러 언어로 작성된 소프트웨어에서 소비할 수 있다.

> 속성의 타입을 정할 땐 되도록 기본 데이터 타입을 써서 여러 프로그래밍 언어에서 지원할 수 있도록 해야 한다.

> JSON에서 지원하는 타입을 사용하자!

각 속성들에 대해 다음과 같은 특성을 수집해야 한다.

- 이름
- 타입
- 필수 여부
- 필요한 경우 부가 설명

> 필수가 아니면 기본값이 무엇인지도 꼭 알려줘야 한다.

## API를 디자인할 때 REST가 중요한 이유

REST는 광범위하게 적용된 API 스타일이며, REST 아키텍처 스타일의 견고한 토대를 기반으로 하므로 어떤 타입의 API를 생성하건 반드시 알아야 한다.

REST API는 REST 아키텍처 스타일에 기반하고 있고, REST 아키텍처 스타일은 어떤 타입의 API를 디자인할 때건 알아두면 유용한 확실하고 기초가 되는 원칙에 의존하기 때문이다.

### REST 아키텍처 스타일

REST 아키텍처 스타일은 2000년 로이 필딩의 박사논문 "아키텍처 스타일과 네트워크 기반 소프트웨어 아키텍처 설계"에서 소개됐다.

REST 아키텍처 스타일의 목표는 효율적이고 확장 가능하며 안정적인 분산시스템을 구축하는 것이다.

- 클라이언트 / 서버 분리
- 스테이트리스: 리퀘스트를 처리하는데 필요한 모든 정보는 해당 리퀘스트에 포함되어 있어야 한다. 서버는 리퀘스트를 처리한ㄴ데 필요한 클라이언트의 그 어떤 컨텍스트도 서버의 세션에 담지 않는다.
- 캐시 가능성
- 레이어드 시스템: 클라이언트가 서버와 상호작용을 할 때, 오직 서버만을 알고 있어야 한다. 서버를 이루는 인프라스트럭쳐는 계속 뒷단에 숨겨져 있어야 한다. 클라이언트는 오직 시스템에서 하나의 레이어만 볼 수 있어야 한다.
- 코드 온 디멘드: 서버는 필요하다면 클라이언트에 실행 가능한 코드를 전송할 수 있어야 한다.
- 유니폼 인터페이스: 모든 상호작용은 식별된 리소스의 개념에 따라 이루어져야 하며, 상호작용은 리소스의 표현이 무엇을 의미하는지와 이 리소스들로 무엇을 할 수 있는지 알려줄 수 있는 모든 메타데이터를 제공해야 한다.

# 4. API 명세 포맷을 이용한 API 디자인

API 명세란 API의 세부사항을 표현하기 위한 데이터 포맷으로, 프로그래밍 인터페이스에서 데이터를 정확하게 설명하고자 할 때는 API 명세 포맷을 이용하는 편이 좋다.
특히 프로젝트와 관련된 모든 사람들과 디자인을 공유할 때 가장 효율적이다.

## OAS(OpenAPI Specification)

**OAS는 프로그래밍 언어에 상관없이 사용하는 REST API 명세 포맷이다.**

기본 OAS 문서는 API 이름이나 버전 같은 일반적인 정보를 제공하며, 가용한 리소스와 리소스들의 가능한 HTTP 메서드로 식별된 동작들, 그리고 파라미터와 리스폰스를 묘사한다.

OAS와 같은 명세 포맷을 통해 텍스트 파일에 구조화된 데이터를 표현할 수 있다.

## API 명세 포맷을 사용해야 하는 이유

워드프로세서나 스프레드시트 문서를 사용해 프로그래밍 인터페이스를 설명할 수도 있다. 하지만 API 명세 포맷의 장점이 훨씬 많다.
API 설명 형식을 사용하면 특히 디자인 단계를 비롯한 API 라이프사이클 전체에 걸쳐 이점을 얻을 수 있으며 이러한 장점은 단순히 프로바이더에게만 국한된 것이 아니라 컨슈머들에게도 적용된다.

- API를 코드 작성하듯 효율적으로 쓸 수 있다
- API 명세와 API 문서를 쉽게 공유할 수 있다
- 코드 생성 이상이 가능하다

API 명세 포맷은 프로그래밍 인터페이스를 설명하기 위해 필요하다. 단, 목표와 컨셉, 데이터를 프로그래밍 가능한 표현으로 설계할 때 사용해야 한다.
