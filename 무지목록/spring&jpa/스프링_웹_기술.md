스프링 웹 기술의 핵심이자 기반이 되는 것이 `DispatcherServlet`이다. 이 서블릿은 스프링의 웹 기술을 구성하는 다양한 전략을 DI로 구성해서 확장하도록 만들어진 스프링 서블릿/MVC의 엔진과 같은 역할을 한다.

MVC 아키텍처는 보통 `프론트 컨트롤러(front controller) 패턴`과 함께 사용된다. 프론트 컨트롤러 패턴은 중앙집중형 컨트롤러를 프레젠테이션 계층의 제일 앞에 둬서 서버로 들어오는 모든 요청을 받아서 처리하게 만드는 방식이다. 프론트 컨트롤러는 클라이언트가 보낸 요청을 받아서 공통적인 작업을 먼저 수행한 후에 적절한 세부 컨트롤러로 작업을 위임해주고, 클라이언트에게 보낼 뷰를 선택해서 최종 결과를 생성하는 등의 작업을 수행한다.

스프링이 제공하는 스프링 서블릿/MVC의 핵심은 `DispatcherServlet`이라는 프론트 컨트롤러다. 

### 1. DispatcherServlet의 HTTP 요청 접수
자바 서버의 서블릿 컨테이너는 HTTP 프로토콜을 통해 들어오는 요청이 스프링의 `DispatcherServlet`에 할당된 것이라면 HTTP 요청 정보를 `DispatcherServlet`에 전달한다.

`DispatcherServlet`은 모든 요청에 대해 공통적으로 진행해야 하는 전처리 작업이 등록된 것이 있다면 이를 먼저 수행한다. 보안이나 파라미터 조작, 한글 디코딩 같은 작업이 해당된다.

### 2. DispatcherServlet에서 컨트롤러로 HTTP 요청 위임
`DispatcherServlet`은 URL이나 파라미터 정보, HTTP 명령 등을 참고해서 어떤 컨트롤러에게 작업을 위임할지 결정한다. 이 때 `핸들러 매핑 전략`을 이용해 컨트롤러를 선정한다. 스프링에서는 컨트롤러를 핸들러라고도 부른다. 웹의 요청을 다루는(handle) 오브젝트라는 의미다. **사용자 요청을 기준으로 어떤 핸들러에게 작업을 위임할지를 결정해 주는 것을 핸들러 매핑 전략이라고 한다.**
> 핸들러 매핑(Handler Mapping)은 URL과 요청 정보를 기준으로 어떤 컨트롤러를 사용할 것인지를 결정하는 로직을 담당한다. DispatcherServlet은 하나 이상의 핸들러 매핑을 가질 수 있다.

어떤 컨트롤러/핸들러가 요청을 처리하게 할지 결정했다면, 다음은 해당 컨트롤러 오브젝트의 메서드를 호출해서 실제로 웹 요청을 처리하는 작업을 위임한다. 

`DispatcherServlet`은 컨트롤러가 어떤 메서드를 가졌고, 어떤 인터페이스를 구현했는지 전혀 알지 못한다. 대신 컨트롤러의 종류에 따라 적절한 어댑터를 사용한다. 각 어댑터는 자신이 담당하는 컨트롤러에 맞는 호출 방법을 이용해서 컨트롤러에게 작업 요청을 보내고 결과를 돌려받아서 `DispatcherServlet`에게 다시 돌려주는 기능을 갖고 있다. 스프링 서블릿/MVC 확장구조의 기본은 바로 어댑터를 통한 컨트롤러 호출 방식이다. **어떤 어댑터를 사용할지는 `DispatcherServlet` 전략의 하나인 핸들러 어댑터 전략을 통해 결정한다.**
> 핸들러 어댑터(Handler Adapter)는 핸들러 매핑으로 선택한 컨트롤러를 DispatcherServlet이 호출할 때 사용하는 어댑터다. 컨트롤러 타입에는 제한이 없기 때문에 호출 방법도 타입에 따라 달라진다. 그래서 컨트롤러 타입을 지원하는 핸들러 어댑터가 필요한 것이다. 컨트롤러 타입에 적합한 어댑터를 이용해 컨트롤러를 호출해야 한다.

`DispatcherSerlvet`이 핸들러 어댑터에 웹 요청을 전달할 때는 모든 웹 요청 정보가 담긴 `HttpServletRequest` 타입의 오브젝트를 전달한다. 이를 어댑터가 적절히 변환해서 컨트롤러의 메서드가 받을 수 있는 파라미터로 변환해서 전달해주는 것이다. `HttpServletResponse`도 함께 전달해준다. 결과를 리턴 값으로 돌려주는 대신 `HttpServletResponse` 오브젝트 안에 직접 집어넣을 수도 있기 때문이다.

### 3. 컨트롤러의 모델 생성과 정보 등록
컨트롤러의 작업은 먼저 사용자 요청을 해석하고 그에 따라 실제 비즈니스 로직을 수행하도록 서비스 계층 오브젝트에게 작업을 위임한다. 그리고 결과를 받아서 모델을 생성하고 마지막으로 어떤 뷰를 사용할지 결정한다.

### 4. 컨트롤러의 결과 리턴: 모델과 뷰
스프링에는 `ModelAndView`라는 이름의 오브젝트가 있는데, 이 오브젝트가 `DispatcherServlet`이 최종적으로 어댑터를 통해 컨트롤러로부터 돌려받는 오브젝트다. 이름 그대로 모델과 뷰, 두 가지 정보를 담고 있다.

모델과 뷰를 넘기는 것으로 컨트롤러의 책임은 끝이다. 이제 작업은 다시 `DispatcherServlet`으로 넘어간다.

### 5. DispatcherServlet의 뷰 호출과 모델 참조
컨트롤러부터 모델과 뷰를 받은 뒤에는 뷰 오브젝트에게 모델을 전달해주고 클라이언트에게 돌려줄 최종 결과물을 생성해줄 것을 요청하는 것이다.

뷰 작업을 통한 최종 결과물은 `HttpServletResponse` 오브젝트 안에 담긴다.

### 6. HTTP 응답 돌려주기
뷰 생성까지의 모든 작업을 마치면 `DispatcherServlet`은 등록된 후처리기가 있는지 확인하고, 있다면 후처리기에서 후속 작업을 진행한 뒤에 뷰가 만들어준 `HttpServletResponse`에 담긴 최동 결과를 서블릿 컨테이너에게 돌려준다.

# `@Controller` 애노테이션
스프링 MVC는 애노테이션 기반의 프로그래밍 모델을 제공한다. `@Controller` 혹은 `@RestController` 애노테이션이 붙은 클래스는 컨트롤러 역할을 수행한다. 컨트롤러 기본 클래스를 확장하거나 Servlet API를 참조할 필요가 없다. 컨트롤러는 요청을 매핑하고, 요청 입력을 받고, 예외 처리 등을 하게 된다.

컨트롤러가 `DispatcherServlet`으로부터 실행되는 과정은, 핸들러 어댑터가 `DispatcherServlet`으로부터 `HttpServletRequest`와 `HttpServletResponse`를 받아 이를 컨트롤러가 사용하는 파라미터 타입으로 변환해서 제공한다. 그리고 컨트롤러부터 받은 결과를 `ModelAndView`타입의 오브젝트에 담아 다시 `DispatcherServlet`으로 돌려준다.

---
참고
- 토비의 스프링 3.1 Vol. 2: 스프링의 기술과 선택
- [Spring Framewokr Docs](https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#spring-web)
