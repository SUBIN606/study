# 네트워크
네트워크란 노드와 링크가 서로 연결되어 있거나 연결되어 있으며 리소스를 공유하는 집합을 의미한다.

노드란 서버, 라우터, 스위치 등 네트워크 장치를 의미하고 링크는 유선 또는 무선을 의미한다.

### 처리량과 지연 시간
처리량(throughput)이란 링크를 통해 전달되는 단위 시간당 데이터양을 말하며, 단위로는 bps(bits per second)를 쓴다. 초당 전송 또는 수신되는 비트 수라는 의미이다.

지연 시간(latency)이란 요청이 처리되는 시간을 말하며 어떤 메시지가 두 장치 사이를 왕복하는 데 걸린 시간을 말한다.

처리량은 사용자들이 많이 접속할 때마다 커지는 트래픽, 네트워크 장치 간의 대역폭, 네트워크 중간에 발생하는 에러, 장치의 하드웨어 스펙에 영향을 받는다. 지연 시간은 매체 타입(무선, 유선), 패킷 크기, 라우터의 패킷 처리 시간에 영향을 받는다.

### 네트워크 토폴로지
네트워크 토폴로지는 노드와 링크가 어떻게 배치되어 있는지에 대한 방식이자 연결 형태를 의미한다.

> 스푸핑은 LAN 상에서 송신부의 패킷을 송신과 관련 없는 다른 호스트에 가지 않도록 하는 스위치 기능을 마비시키거나 속여서 특정 노드에 해당 패킷이 오도록 처리하는 것을 말한다. 스푸핑을 적용하면 올바르게 수신부로 가야 할 패킷이 악의적인 노드에 전달되게 된다.

### 병목현상
토폴로지가 중요한 이유는 병목 현상을 찾을 때 중요한 기준이 되기 때문이다.

### 네트워크 성능 분석 명령어
- `ping`(Packet INternet Groper): 네트워크 상태를 확인하려는 대상 노드를 향해 일정 크기의 패킷을 전송하는 명령어로 네트워크가 잘 연결되어 있는지 확인할 수 있다.
- `netstat`: 접속되어 있는 서비스들의 네트워크 상태를 표시하는 데 사용되며 주로 서비스의 포트가 열려있는지 확인할 때 사용한다.
- `nslookup`: DNS에 관련된 내용을 확인하기 위해 쓰는 명령어로 특정 도메인에 매핑된 IP를 확인하기 위해 사용한다.
- `tracert(traceroute)`: 목적지 노드까지 네트워크 경로를 확인할 때 사용하는 명령어로 목적지 노드까지 구간들 중 어느 구간에서 응답 시간이 느려지는지 등을 확인할 수 있다.

# TCP/IP 4계층 모델
## 애플리케이션 계층
애플리케이션 계층은 FTP, HTTP, SSH, SMTP, DNS 등 응용 프로그램이 사용되는 프로토콜 계층이며 웹 서비스, 이메일 등 서비스를 실질적으로 사람들에게 제공하는 계층이다.

## 전송 계층
전송 계층은 송신자와 수신자를 연결하는 통신 서비스를 제공하며 연결 지향 데이터 스트림 지원, 신뢰성, 흐름 제어를 제공할 수 있으며 애플리케이션과 인터넷 계층 사이의 데이터가 전달될 때 중계 역할을 하며 대표적으로 TCP, UDP가 있다.

### TCP 연결 성립 과정
TCP는 신뢰성을 확보할 때 3-way handshake라는 작업을 진행한다. 

1. SYN 단계: 클라이언트는 서버에 클라이언트의 ISN을 담아 SYN을 보낸다. ISN은 새로운 TCP 연결의 첫 번째 패킷에 할당된 임의의 시퀀스 번호를 말하며 이는 장치마다 다를 수 있다.
2. SYN + ACK 단계: 서버는 클라이언트의 SYN을 수신하고 서버의 ISN을 보내며 승인번호로 클라이언트의 ISN + 1을 보낸다.
3. ACK 단계: 클라이언트는 서버의 ISN + 1한 값인 승인번호를 담아 ACK를 서버에 보낸다.

이러한 핸드셰이크 과정 이후 신뢰성이 구축되고 데이터 전송을 시작한다. 이 과정 때문에 TCP는 신뢰성이 있는 계층이라고 하며, UDP는 이 과정이 없기 때문에 신뢰성이 없는 계층이라고 한다.

- SYN(SYNchronization): 연결 요청 플래그
- ACK(ACKnowledgement): 응답 플래그
- ISN(Initial Sequence Numbers): 초기 네트워크 연결을 할 때 할당된 32비트 고유 시퀀스 번호

### TCP 연결 해제 과정
TCP가 연결을 해제할 때는 4-way handshake 과정이 발생한다.

1. 클라이언트가 연결을 닫으려고 할 때 FIN으로 설정된 세그먼트를 보낸다. 그리고 클라이언트는 `FIN_WAIT_1` 상태로 들어가고 서버의 응답을 기다린다.
2. 서버는 클라이언트로 ACK라는 승인 세그먼트를 보낸다. 그리고 `CLOSE_WAIT` 상태에 들어간다. 클라이언트가 세그먼트를 받으면 `FIN_WAIT_2` 상태에 들어간다.
3. 서버는 ACK를 보내고 일정 시간 이후에 클라이언트에게 FIN이라는 세그먼트를 보낸다.
4. 클라이언트는 `TIME_WAIT` 상태가 되고 다시 서버로 ACK를 보내서 서버는 `CLOSED` 상태가 된다. 이후 클라이언트는 어느 정도의 시간을 대기한 후 연결이 닫히고 클라이언트와 서버의 모든 자원의 연결이 해제된다.

> FIN 세그먼트를 받고 나서 클라이언트가 `TIME_WAIT` 상태가 되는 이유는 지연 패킷이 발생할 경우를 대비하기 위해서이다. 패킷이 뒤늦게 도달하고 이를 처리하지 못하면 데이터 무결성 문제가 발생하기 때문이다. 또한 두 장치가 연결이 닫혔는지 확인하기 위해서이다. 만약 `LAST_ACK` 상태에서 닫히게 되면 다시 새로운 연결을 하려고 할 때 장치는 줄곧 `LAST_ACK`로 되어 있기 때문에 접속 오류가 나타나게 될 것이다. OS마다 TIME_WAIT 시간은 조금씩 다르다.

## 인터넷 계층
인터넷 계층은 장지로부터 받은 네트워크 패킷을 IP 주소로 지정된 목적지로 전송하기 위해 사용되는 계층이다. IP, ARP, ICMP 등이 있으며 패킷을 수신해야 할 상대의 주소를 지정해 데이터를 전달한다. 상대방이 제대로 받았는지에 대해 보장하지 않는 비연결형적인 특징을 가지고 있다.

## 링크 계층
링크 계층은 전선, 광섬유, 무선 등으로 실질적으로 데이터를 전달하며 장치 간에 신호를 주고받는 규칙을 정하는 계층으로 네트워크 접근 계층이라고도 한다.

### PDU(Protocol Data Unit)
네트워크의 어떠한 계층에서 계층으로 데이터가 전달될 때 한 덩어리의 단위를 PDU라고 한다. PDU는 제어 관련 정보들이 포함된 '헤더', 데이터를 의미하는 '페이로드'로 구성되어 있으며 계층마다 부르는 명칭이 다르다.

- 애플리케이션 계층: 메시지
- 전송 계층: 세그먼트(TCP), 데이터그램(UDP)
- 인터넷 계층: 패킷
- 링크 계층: 프레임(데이터 링크 계층), 비트(물리 계층)

## 네트워크 기기
### L7 스위치
L7 스위치는 로드밸런서라고도 하며, 서버의 부하를 분산하는 기기이다. 클라이언트로부터 오는 요청들을 뒤쪽의 여러 서버로 나누는 역할을 하며 시스템이 처리할 수 있는 트래픽 증가를 목표로 한다.

만약 장애가 발생한 서버가 있다면 이를 트래픽 분산 대상에서 제외해야 한다. 이는 정기적으로 헬스 체크를 이용해 감시하면서 이루어진다.

L4 스위치 또는 L7 스위치 모두 헬스 체크를 통해 정상 서버와 비정상 서버를 판별한다. 헬스체크란 전송 주기와 재전송 횟수 등을 설정한 이후 반복적으로 서버에 요청을 보내는 것을 말한다. TCP, HTTP 등 다양한 방법으로 요청을 보내며 이 요청이 정상적으로 이루어졌다면 정상적인 서버로 판별한다.

## HTTPS
HTTPS는 애플리케이션 계층과 전송 계층 사이에 신뢰 계층인 SSL/TLS 계층을 넣은 신뢰할 수 있는 HTTP 요청을 말한다.

SSL/TLS는 전송 계층에서 보안을 제공하는 프로토콜로 클라이언트와 서버가 통신할 때 SSL/TLS를 통해 제3자가 메시지를 도청하거나 변조하지 못하도록 한다. SSL/TLS는 보안 세션을 기반으로 데이터를 암호화하며 보안 세션이 만들어질 때 인증 메커니즘, 키 교환 암호화 알고리즘, 해싱 알고리즘이 사용된다.

---
## 스터디에서 나온 모의면접 질문

- TCP 연결 과정과 해제 과정을 아는대로 설명해주세요

- TCP/UDP 차이점을 설명해주세요

TCP는 패킷 사이의 순서를 보장하고 연결지향 프로토콜을 사용해 연결하여 신뢰성을 구축해 수신 여부를 확인하며 '가상회선 패킷 교환 방식'을 사용한다.
반면 UDP는 순서를 보장하지 않고 수신 여부를 확인하지 않으며 단순히 데이터만 주는 '데이터그램 패킷 교환 방식'을 사용한다.

UDP가 순서가 보장되지 않는 이유는 데이터그램 패킷 교환 방식을 사용하기 때문이다. 데이터그램 패킷 교환 방식은 패킷이 독립적으로 이동하며 최적의 경로를 선택하기 때문에 하나의 메시지에서 분할된 여러 패킷이 서로 다른 경로로 전송될 수 있기 때문에 도착하는 순서가 달라질 수 있다.

TCP는 가상회선 패킷 교환 방식을 사용하는데, 각 패킷에 가상회선 식별자가 포함되기 때문에 패킷들이 순서대로 도착할 수 있다.

- TCP/IP 4계층 모델의 전송 계층에 대해 설명해주세요

- DNS에 대해 설명해주세요

- 네트워크 관련 명령어

ping으로 서버 요청이 제대로 오는지 확인해본다. 응답이 온다면 curl을 이용해서 응답이 제대로 오는지를 확인한다. netstat은 IP를 확인하기 위해 사용한다.

- 로드밸런서(로드밸런싱)에 대해 설명해주세요

클라이언트로부터 오는 요청들을 뒤쪽의 여러 서버로 나누는 역할을 한다. 시스템이 처리할 수 있는 트래픽 증가를 목표로 한다.
로드밸런서의 대표적인 기능은 서버 이중화를 들 수 있다. 서비스를 안정적으로 운용하기 위해 2대 이상의 서버가 필수적인데, 로드밸런서는 2대 이상의 서버를 기반으로 가상 IP를 제공해 이를 기반으로 안정적인 서비스를 제공한다.

- L4 스위치와 L7 스위치의 차이점에 대해 설명해주세요

L4 스위치는 전송 계층을 처리하는 기기로 스트리밍 관련 서비스에서는 사용할 수 없으며 메시지를 기반으로 인식하지 못하고 IP와 포트를 기반으로(특히 포트를 기반으로) 트래픽을 분산한다. 반면 L7 로드밸런서는 IP, 포트 외에도 URL, HTTP 헤더, 쿠키 등을 기반으로 트래픽을 분산한다.

- HTTP/1.0과 HTTP/1.1의 차이점에 대해 설명해주세요

HTTP/1.0은 모든 요청마다 연결을 새로 해야 했기 때문에 3-웨이 핸드셰이크 과정이 증가해, RTT가 증가한다는 단점이 있었다. 그래서 HTTP/1.1 에서는 매번 TCP 연결을 하는 것이 아니라 한 번 TCP 초기화를 한 이후에 keep-alive라는 옵션을 통해 한 번의 연결을 수립하고 요청을 주고받을 수 있게 되었다.
