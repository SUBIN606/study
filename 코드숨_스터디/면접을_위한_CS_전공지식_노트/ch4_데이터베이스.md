# 4. 데이터베이스
데이터베이스는 일정한 규칙, 혹은 규약을 통해 구조화되어 저장되는 데이터의 모음이다.

데이터베이스를 제어, 관리하는 통합 시스템을 DBMS(DataBase Management System)라고 하며, 데이터베이스 안에 있는 데이터들은 특정 DBMS마다 정의된 쿼리 언어를 통해 삽입, 삭제, 수정, 조회 등을 수행할 수 있다.

## 엔티티
엔티티(entity)는 사람, 장소, 물건, 사건, 개념 등 여러 개의 속성을 지닌 명사를 의미한다. 

엔티티는 약한 엔티티와 강한 엔티티로 나뉜다. A가 혼자서는 존재하지 못하고 B의 존재 여부에 따라 종속적이라면 A는 약한 엔티티이고, B는 강한 엔티티라고 할 수 있다.

## 릴레이션
릴레이션(relation)은 데이터베이스에서 정보를 구분하여 저장하는 기본 단위이다. 엔티티에 관한 데이터를 데이터베이스는 릴레이션 하나에 담아 관리한다.

릴레이션은 관계형 데이터베이스에서는 '테이블'이라고 하며, NoSQL에서는 '컬렉션'이라고 한다.

## 관계
데이터베이스에는 여러 개의 테이블이 있고 이러한 테이블은 서로의 관계가 정의되어 있다.

## 키
슈퍼키는 유일성이 있고 그 안에 포함된 후보키는 최소성까지 갖춘 키이다. 후보키 중 기본키로 선택되지 못한 키는 대체키가 된다. 유일성이란 중복되는 값이 없다는 뜻이고, 최소성은 필드를 조합하지 않고 최소 필드만 써서 키를 형성할 수 있는 것을 말한다.

### 기본키
기본키(Primary Key)는 줄여 PK 또는 프라이머리키라고 많이 부르며, 유일성과 최소성을 만족한다.

기본키는 자연키 또는 인조키 중에 골라 설정한다.
- 자연키: 중복된 값들을 제외하며 중복되지 않는 것을 '자연스레' 뽑다가 나오는 키, 언젠가는 변한다
- 인조키: 인위적으로 부여한 식별자, 변하지 않으므로 보통 인조키로 설정함

### 외래키
외래키(Foreign Key)는 FK라고도 한다. 다른 테이블의 기본키를 그대로 참조하는 값으로 개체와의 관계를 식별하는 데 사용한다.

외래키는 중복되어도 괜찮다.

### 후보키
후보키(candidate key)는 기본키가 될 수 있는 후보들이며 유일성과 최소성을 동시에 만족하는 키이다.

### 대체키
대체키(alternate key)는 후보키가 두 개 이상일 경우 어느 하나를 기본키로 지정하고 남은 후보키들을 말한다.

### 슈퍼키
슈퍼키(super key)는 각 레코드를 유일하게 식별할 수 있는 유일성을 갖춘 키이다.

## ERD
ERD(Entity Relationship Diagram)는 데이터베이스를 구축할 때 가장 기초적인 뼈대 역할을 하며, 릴레이션 간의 관계들을 정의한 것이다.

## 정규화 과정
정규화 과정은 릴레이션 간의 잘못된 종속관계로 인해 데이터베이스 이상 현상이 일어나서 이를 해결하거나, 저장 공간을 효율적으로 사용하기 위해 릴레이션을 여러 개로 분리하는 과정이다.

정규화 과정은 정규형 원칙을 기반으로 정규형을 만들어가는 과정이며, 정규화된 정도는 정규형(NF, Normal Form)으로 표현한다.

### 정규형 원칙
정규형의 원칙이란 같은 의미를 표현하는 릴레이션이지만 좀 더 좋은 구조로 만들어야 하고, 자료의 중복성은 감소해야 하고, 독립적인 관계는 별개의 릴레이션으로 표현해야 하며, 각각의 릴레이션은 독립적인 표현이 가능해야 하는 것을 말한다.

## 트랜잭션
트랜잭션이란 데이터베이스에서 하나의 논리적 기능을 수행하기 위한 작업의 단위를 말한다.
즉, 데이터베이스에서는 여러 개의 쿼리들을 하나로 묶는 단위를 뜻한다. 이에 대한 특징은 원자성, 일관성, 독립성, 지속성이 있으며 합쳐서 ACID 특징이라고 한다.

### 원자성(atomicity)
원자성은 트랜잭션과 관련된 일이 모두 수행되었거나 되지 않았거나를 보장하는 특징이다.

### 일관성(consistency)
일관성은 '허용된 방식'으로만 데이터를 변경해야 하는 것을 의미한다. 데이터베이스에 기록된 모든 데이터는 여러 가지 조건, 규칙에 따라 유효함을 가져야 한다.

### 격리성(isolation)
격리성은 트랜잭션 수행 시 서로 끼어들지 못하는 것을 말한다. 복수의 병렬 트랜잭션은 서로 격리되어 마치 순차적으로 실행되는 것처럼 작동되어야 하고, 데이터베이스는 여러 사용자가 같은 데이터에 접근할 수 있어야 한다.

데이터베이스는 여러 개의 격리 수준으로 나눠 격리성을 보장한다.

### 지속성(durability)
지속성은 성공적으로 수행된 트랜잭션은 영원히 반영되어야 하는 것을 의미한다. 이는 데이터베이스에 시스템 장애가 발생해도 원래 상태로 복구하는 회복 기능이 있어야 함을 뜻한다.

## 무결성
무결성이란 데이터의 정확성, 일관성, 유효성을 유지하는 것을 말하며 무결성이 유지되어야 데이터베이스에 저장된 데이터 값과 그 값에 해당하는 현실 세계의 실제 값이 일치하는지에 대한 신뢰가 생긴다.

- 개체 무결성: 기본키로 선택된 필드는 빈 값을 허용하지 않는다
- 참조 무결성: 서로 참조 관계에 있는 두 테이블의 데이터는 항상 일관된 값을 유지해야 한다
- 고유 무결성: 특정 속성에 대해 고유한 값을 가지도록 조건이 주어진 경우 그 속성 값은 모두 고유한 값을 가진다
- NULL 무결성: 특정 속성 값에 NULL이 올 수 없다는 조건이 주어진 경우 그 속성 값은 NULL이 될 수 없다

## 인덱스
인덱스는 데이터를 빠르게 찾을 수 있는 하나의 장치이다.

## B-트리
인덱스는 보통 B-트리라는 자료 구조로 이루어져있다. 이는 루트 노드, 리프 노드, 그리고 루트 노드와 리프 노드 사이에 있는 브랜치 노드로 나뉜다.

트리 탬삭은 맨 위 루트 노드부터 탐색이 일어나며 브랜치 노드를 거쳐 리프 노드까지 내려온다. 

> 인덱스는 같음, 정렬, 다중 값, 카디널리티 순이다. 즉, `==`이나 `equal` 쿼리가 있다면 제일 먼저 인덱스로 설정한다. 그리고 정렬에 쓰는 필드를 그 다음 인덱스로 설정한다. 그리고 다중 값 `>` 이거나 `<` 등 많은 값을 출력해야 하는 쿼리에 쓰는 필드는 나중에 설정한다. 카디널리티가 높은 순서를 기반으로 인덱스를 생성한다.


---
- 기본키는 어떤 조건을 만족해야 하나요?
  - 기본키는 유일성과 최소성을 만족해야 합니다. 유일성이란 중복되는 값이 없다는 뜻이고, 최소성은 최소 필드만 써서 키를 형성할 수 있다는 뜻입니다.
- 기본키를 인조키로 설정하는것과 자연키로 설정하는 것의 차이가 무엇이 있을까요?
  - 자연키는 중복된 값을 제거하면서 자연스럽게 찾은 키를 말하는데, 이는 언젠가 중복이 되거나 비즈니스 요구사항이 변함에 따라 더이상 필요없어지기도 합니다. 따라서 요즘은 인조키 즉, 인위적으로 부여한 식별자를 기본키로 많이 사용합니다. 보통 MySQL에서는 AUTO_INCREMENT를 사용해 인조키를 부여합니다.
- 트랜잭션이란 무엇인가요?
  - 트랜잭션이란 하나의 논리적 기능을 수행하기 위한 작업의 단위를 말합니다.
  - 트랜잭션의 특징으로는 ACID가 있습니다. 원자성, 일관성, 격리성, 지속성을 말합니다.
    - 원자성이란 트랜잭션이 모두 반영되거나 모두 반영되지 않거나의 상태만 가질 수 있다는 것입니다. 만약 여러 쿼리를 실행하던 도중 한 쿼리가 실패하면 이전의 쿼리도 모두 실행되기 전 상태로 돌아가야 합니다. 이를 커밋과 롤백으로 처리할 수 있습니다.
    - 일관성은 데이터베이스에 기록된 모든 데이터는 여러 조건과 규칙에 따라 유효해야 한다는 뜻입니다. 일관성은 보통 애플리케이션단에서 처리하기도 합니다.
    - 격리성은 여러 트랜잭션이 동시에 실행되더라도 모두 독립적인 것처럼 실행되어야 한다는 특징입니다.
    - 지속성은 성공적으로 수행된 트랜잭션은 영원히 데이터베이스에 반영된다는 것입니다.
- 인덱스를 사용하면 얻는 이점이 뭔가요?
  - 인덱스를 사용하면 빠르게 데이터를 읽을 수 있습니다.
  - 인덱스는 읽기 성능을 위해 쓰기(INSERT, UPDATE, DELETE) 성능을 포기합니다. MySQL로 설명하자면 MySQL의 InnoDB 스토리지 엔진의 인덱스는 B-Tree 자료 구조로 이루어져있습니다. 이 B-Tree 구조는 루트노드, 브랜치노드, 리프노드로 이루어져있는데 데이터 쓰기를 할 때 리프노드에 데이터가 추가되는데 이 때 리프노드가 꽉찬 상태라면 리프노드를 split해야 합니다. 이런 추가적인 과정이 있기 때문에 쓰기에서는 좀 더 성능이 낮다고 할 수 있습니다.
- 팬텀리드, non-repeatable read, 더티리드에 대해 트랜잭션 격리 수준과 연관지어 설명해주세요
  - 팬텀리드란 한 트랜잭션 내에서 동일한 쿼리를 보냈을 때 조회 결과가 다른 것을 말합니다.
  - non-repeatable read는 한 트랜잭션 내에서 같은 행에 두 번 이상 조회했을 때 다른 값이 나오는 경우를 말합니다.
    - 팬텀리드와 non-repeatable read의 차이점은 팬텀리드는 다른 행이 선택될 수 있습니다.
  - 더티리드는 아직 커밋되지 않은 데이터를 읽을 수 있는 것을 말합니다.
  - READ UNCOMMITED 수준에서는 더티리드, non-repeatable read, 팬텀리드 모두 발생합니다.
  - READ COMMITED 수준에서는 커밋된 데이터만 읽을 수 있기 때문에 더티리드는 발생하지 않지만, non-repeatable read, 팬텀리드는 발생합니다.
  - REPEATABLE READ 수준에서는 팬텀리드는 발생할 수 있습니다.

- 카디널리티란 무엇인가요?
  - 카디널리티는 유니크한 값의 정도를 말합니다. 예를 들어 age와 email이 있다면 email이 카디널리티가 더 높으며 email을 인덱스로 생성하는 것이 유리합니다.

- 데이터베이스에서 릴레이션이란?
  - 데이터베이스에서 정보를 구분하여 저장하는 기본 단위로, 관계형데이터베이스에 릴레이션이란 '테이블'을 뜻합니다.
- 정규화란 무엇이며 정규형을 어떻게 만들 수 있는가?
  - 정규화란 데이터베이스에서 중복되거나 불필요한 데이터를 제거하고 데이터의 일관성, 무결성, 효율성을 높이기 위한 과정을 말합니다.
